### Register User

**Endpoint**:  
`POST /api/auth/register`

**Description**:  
This endpoint allows users to register. Depending on whether the user is an Admin or an Employee, the required fields will differ:
- **Admin**: Registers with a `company_name`.
- **Employee**: Registers using an invitation token (`invite_token`) sent by the Admin.

**Request Body**:

```json
{
  "username": "string",          // required
  "company_name": "string",      // required if is_employee is false (Admin)
  "email": "string",             // required
  "password": "string",          // required
  "invite_token": "string",      // required if is_employee is true (Employee)
  "is_employee": false           // optional, default is false (Admin)
}
```

**Response**:

**Success (200)**:

```json
{
  "message": "Congratulations, you registered successfully"
}
```

**Failure (400)**:

- **Missing required fields**:

```json
{
  "error": "Missing required field"
}
```

- **Missing Company Name for Admin**:

```json
{
  "error": "Missing the Company Name"
}
```

- **Missing Invite Token for Employee**:

```json
{
  "error": "Missing the invite token"
}
```

- **Duplicate Email/Username**:

```json
{
  "error": "The email is already taken, choose another one. The username is already taken, choose another one."
}
```

- **Invalid or Expired Token for Employee**:

```json
{
  "error": "Invalid or expired token"
}
```

**Additional Details**:
- **Admin Registration**:  
  The `company_name` is required. A new factory is created for each Admin, and the Admin is linked to that factory.
  
- **Employee Registration**:  
  Requires a valid `invite_token` generated by the Admin. The Employee is linked to the same factory as the Admin who sent the invite.

--- 
### User Login

**Endpoint**:  
`POST /api/auth/login`

**Description**:  
This endpoint allows users (Admins and Employees) to log in by providing valid email and password credentials.

**Request Body**:

```json
{
  "email": "string",    // required
  "password": "string"  // required
}
```

**Response**:

**Success (200)**:

- If the credentials are valid, the server will return an access token and a refresh token.

```json
{
  "access_token": "string",   // JWT for accessing protected routes
  "refresh_token": "string",  // JWT for refreshing the access token
  "is_employee": true/false   // Whether the user is an employee or admin
}
```

**Failure (400)**:

- **Invalid credentials**:

```json
{
  "message": "Invalid credentials"
}
```

**Additional Details**:
- **Access Token**: The `access_token` contains the user's identity and is used to authenticate further requests to the system.
- **Refresh Token**: The `refresh_token` can be used to request a new `access_token` without having to log in again.
- **is_employee**: This boolean flag tells whether the logged-in user is an Admin (`false`) or an Employee (`true`).
---
### Refresh Access Token

**Endpoint**:  
`POST /api/auth/refresh`

**Description**:  
This endpoint allows users to refresh their access token using a valid refresh token. It provides a new access token and a refresh token.

**Request Headers**:

- **Authorization**: A valid refresh token must be provided in the `Authorization` header as a Bearer token.

**Headers**:

```http
Authorization: Bearer <refresh_token>
```

**Response**:

**Success (200)**:

- If the refresh token is valid, the server will return a new access token and a refresh token.

```json
{
  "access_token": "string",        // New JWT for accessing protected routes
  "refresh2_acesstoken": "string"  // New JWT for refreshing the access token
}
```

**Failure (401)**:

- **Expired or Invalid Refresh Token**:

```json
{
  "message": "request does not contain an access token",
  "error": "authorization_required"
}
```

**Additional Details**:
- **Access Token**: The `access_token` is a short-lived token used to authenticate further requests.
- **Refresh Token**: The `refresh2_acesstoken` can be used to request a new access token once the current access token expires.

---
### Invite Employee

**Endpoint**:  
`GET /api/admin/invite`

**Description**:  
This endpoint allows an admin to generate an invitation token for an employee. The token is linked to the admin's factory and can be used to invite employees to join the factory.

**Request Headers**:

- **Authorization**: A valid JWT access token must be provided in the `Authorization` header.

**Headers**:

```http
Authorization: Bearer <access_token>
```

**Response**:

**Success (200)**:

- If the admin is valid and associated with a factory, the server will return an invitation token.

```json
{
  "invite_token": "string"  // The generated token for inviting employees
}
```

**Failure (404)**:

- **User Not Found**: If the admin does not exist in the database:

```json
{
  "error": "User not found."
}
```

**Failure (400)**:

- **No Factory Associated**: If the admin is not linked to a factory:

```json
{
  "error": "Factory ID not associated with this user."
}
```

**Additional Details**:
- **Authorization**: This route is protected, and only admin users can generate the token.
- **Factory Association**: The token is generated based on the `factory_id` associated with the admin.
